<!doctype html>

<html>
  <head>
    <title>3box demo</title>
    <script type="text/javascript" src="../dist/3box.js"></script>
  </head>

  <body>

    <button id="bopen">Open 3box</button>
    <br />
    <div id="controlls" style="display: none">
    <div>
      <h2> Public Store </h2>
      <input type="text" id="prkey" placeholder="Profile Key">
      <input type="text" id="prvalue" placeholder="Profile Value">
      <button id="setProfile">Set Profile Data</button>
      <br />
      <p>
      Profile:<br/>
      <span id="profileData"></span>
      </p>
    </div>
    <div>
      <h2> Private Store </h2>
      <input type="text" id="pskey" placeholder="Private Store Key">
      <input type="text" id="psvalue" placeholder="Private Store Value">
      <button id="setPrivateStore">Set Private Store Data</button>
      <br />
      <p>
      Private Store Data : (Key must be known to get value)<br/><br/>
      <input type="text" id="getpskey" placeholder="Private Store Key">
      <button id="getPrivateStore">Get Private Store Value</button>
      <br /><br />
      <span id="privateStoreData"></span>
      </p>
    </div>
    <div >
      <button id="bclose">Close 3box</button>
    </div>
  </div>
  </body>

  <script type="text/javascript">
    bopen.addEventListener('click', event => {
      ThreeBox.openBox(web3.eth.accounts[0],  web3.currentProvider).then(box => {
        window.box = box
        console.log(box)

        controlls.style.display = 'inline'
        updateProfileData(box)

        setProfile.addEventListener('click', () => {
          box.public.set(prkey.value, prvalue.value).then(() => {
            prkey.value = null
            prvalue.value = null
            updateProfileData(box)
          })
        })

        setPrivateStore.addEventListener('click', () => {
          box.private.set(pskey.value, psvalue.value).then(() => {
            pskey.value = null
            psvalue.value = null
          })
        })

        getPrivateStore.addEventListener('click', () => {
          const key = getpskey.value
          box.private.get(key).then(val => {
            getpskey.value = null
            updatePrivateData(key, val)
          })
        })

        bclose.addEventListener('click', () => {
          logout(box)
        })
      })
    })

    function updateProfileData(box) {
      profileData.innerHTML = ''
      box.public.all().then(profile => {
        console.log(profile)
        Object.entries(profile).map(kv => {
          profileData.innerHTML +=kv[0] + ': ' + kv[1] + '<br />'
        })
      })
    }

    function updatePrivateData(key, value) {
      privateStoreData.innerHTML = ''
      privateStoreData.innerHTML  = key + ': ' + value
    }

    function logout(box){
      box.logout().then(() => {
        privateStoreData.innerHTML = ''
        profileData.innerHTML = ''
        controlls.style.display = 'none'
      })
    }

  </script>

</html>
