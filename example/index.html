<!doctype html>

<html>
  <head>
    <title>3box demo</title>
    <script type="text/javascript" src="../dist/3box.js"></script>
  </head>

  <body>

    <button id="bopen">Open 3box</button>
    <br />
    <div id="controlls" style="display: none">
      <input type="text" id="prkey" placeholder="Profile Key">
      <input type="text" id="prvalue" placeholder="Profile Value">
      <button id="setProfile">Set Profile Data</button>
      <br />
      <p>
      Profile:<br/>
      <span id="profileData"></span>
      </p>
    </div>
  </body>

  <script type="text/javascript">
    bopen.addEventListener('click', event => {
      ThreeBox.openBox(web3.eth.accounts[0],  web3.currentProvider).then(box => {
        console.log(box)

        controlls.style.display = 'inline'
        updateProfileData(box)

        setProfile.addEventListener('click', () => {
          box.public.set(prkey.value, prvalue.value).then(() => {
            prkey.value = null
            prvalue.value = null
            updateProfileData(box)
          })
        })
      })
    })

    function updateProfileData(box) {
      profileData.innerHTML = ''
      box.public.all().then(profile => {
        console.log(profile)
        Object.entries(profile).map(kv => {
          profileData.innerHTML +=kv[0] + ': ' + kv[1] + '<br />'
        })
      })
    }
  </script>

</html>
